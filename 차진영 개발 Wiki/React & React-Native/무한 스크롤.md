# 무한 스크롤

SNS를 사용하다 보면 스크롤을 아래로 내렸을 때 새로운 내용들이 추가되는 것을 확인할 수 있다.

이는 방대한 양의 내용을 필요에 따라 나누어 부하를 적게 받고 호출 순서에 따라 데이터를 관리할 수 있다.

**React**와 **React-Native** 각각 구현 방식이 다르며, **React**는 **Intersection Observer API**, **React-Native**는 **flatList**를 통해 구현한다.

### **React**

```jsx
const bottomRef = useRef(null)

<div>
	{data.map((value, index) => (
		<div key={index}>{value}</div>
	))}
	<div ref={bottomRef} />
</div>
```

`map`을 통해 생성한 데이터 리스트에 대한 **item component**의 하단에 **IntersectionObserver**를 통해 감지할 컴포넌트를 추가한다.

```jsx
const callback = () => {
	// 실행할 콜백함수(데이터 추가 호출 API)
}

useEffect(() => {
	const options = {
		root: document.querySelector('infinite-scroll'),
		rootMargin: '0px',
	  threshold: 1.0
	}

	const observer = new IntersectionObserver(callback, option);
	
	if (bottomRef.current) observer.observe(bottomRef.current);
  
  return () => observer.disconnect();
}, [])
```

**callback** 함수와 **option**을 정하고  **IntersectionObserver**를 선언한다.

**options**

- `root`: 요소의 가시성을 확인하기 위한 루트 요소 (**null**일 경우 **브라우저 뷰포트**로 설정)
- `rootMargin`: **root**의 범위를 확장하기 위한 **margin** 요소
- `threshold`: 어느정도 노출이 되었을 때 **callback 함수**를 호출할 것인지에 대한 가시성 퍼센티지
    
    ⇒ **1.0(100%)**부터 소숫점 단위로 계산
    

`useRef`를 통해 하단 컴포넌트를 observe하여 조건에 일치하는 만큼 관찰되면 **callback 함수**가 실행되어 무한 스크롤이 구현된다.

※ 컴포넌트가 **unmount**되었을 때 `observer.disconnect()`를 통해 관찰을 중지하자

### **React-Native**

```jsx
const callback = () => {
	// 실행할 콜백함수(데이터 추가 호출 API)
}

<FlatList
	data={data}
	keyExtractor={(_) => _.title}
	renderItem={({ item }) => {
	  const { title, content } = item;
		return (
		  <ListItem title={title} content={content}/>
		)
	})}
	onEndReached={callback}
  onEndReachedThreshold={1.0}
  // ListFooterComponent: 하단에 생성할 컴포넌트 ex) 로딩바, ActivityIndicator
/>
```

**React-Native**는 **FlatList**를 통해 쉽게 매핑 리스트를 구현할 수 있고 **React**의 **IntersectionObserver**를 사용할 필요 없이 `onEndReached` 기능이 **FlatList**에 구현되어 있다.

**options**의 `threshold` 의 기능도 `onEndReachedThreshold` 를 통해 수행할 수 있다.

추가적으로 **API**를 호출하여 데이터를 불러오는 로딩 과정을 `ListFooterComponent` 컴포넌트에 `ActivityIndicator` 등을 반환하여 시각적으로 보여줄 수 있다.